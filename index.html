<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ’Œ</title>

  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#1a0b2e;
      --stroke:#ffffff24;
      --txt:#f7f7ff;
      --muted:#cfcfe6;
      --pink:#ff4d8d;
      --pink2:#ff77a7;
      --gold:#ffd7a3;
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background:
        radial-gradient(1100px 700px at 30% 20%, #2a1b55 0%, transparent 60%),
        radial-gradient(900px 600px at 80% 70%, #3a0f3b 0%, transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      overflow:hidden;
    }

    .wrap{ width:min(520px, 92vw); padding:20px; }

    .panel{
      background:linear-gradient(180deg, #ffffff14, #ffffff0a);
      border:1px solid var(--stroke);
      border-radius:22px;
      padding:18px;
      box-shadow: 0 18px 60px #00000055;
      backdrop-filter: blur(8px);
      position:relative;
    }

    .title{
      display:flex;align-items:center;gap:10px;
      font-weight:700;
      letter-spacing:.2px;
      margin:0 0 12px;
      color:var(--muted);
      font-size:14px;
    }

    .stage{
      display:grid;
      place-items:center;
      padding:14px 6px 22px;
    }

    /* Floating hearts */
    .float{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .h{
      position:absolute;
      bottom:-40px;
      font-size:18px;
      opacity:0;
      animation: rise 2400ms ease-in forwards;
      filter: drop-shadow(0 6px 12px #00000055);
    }
    @keyframes rise{
      0%{transform:translateY(0) translateX(0) scale(.9); opacity:0}
      15%{opacity:.9}
      100%{transform:translateY(-520px) translateX(var(--dx)) scale(1.2); opacity:0}
    }

    /* Envelope */
    .envelope{
      width:min(360px, 78vw);
      aspect-ratio: 16 / 11;
      position:relative;
      cursor:pointer;
      transform: translateZ(0);
      user-select:none;
      filter: drop-shadow(0 18px 30px #00000055);
    }
    .env-body{
      position:absolute; inset:0;
      border-radius:18px;
      background: linear-gradient(135deg, #ffeff5 0%, #ffe2ec 45%, #ffd3e3 100%);
      border:1px solid #ffffff88;
      overflow:hidden;
    }
    .env-body:before{
      content:"";
      position:absolute; inset:-60px -40px auto -40px;
      height:120px;
      background: linear-gradient(90deg, transparent, #ffffff85, transparent);
      transform: rotate(12deg);
      opacity:.7;
    }

    /* Flap */
    .flap{
      position:absolute; left:0; right:0; top:0;
      height:58%;
      transform-origin: 50% 0%;
      background: linear-gradient(135deg, #ffd7e6 0%, #ffbcd6 100%);
      clip-path: polygon(0 0, 100% 0, 50% 92%);
      border-top-left-radius:18px;
      border-top-right-radius:18px;
      border:1px solid #ffffff88;
      border-bottom:none;
      transition: transform 700ms cubic-bezier(.2,.9,.2,1);
      z-index:3;
    }
    .envelope.open .flap{ transform: rotateX(180deg); }

    /* Heart seal */
    .seal{
      position:absolute;
      left:50%; top:52%;
      transform: translate(-50%, -50%);
      width:104px; height:104px;
      display:grid; place-items:center;
      z-index:4;
    }

    /* âœ… Sceau wax qui reste (Ã©vite l'effet fade) */
    .seal::before{
      content:"";
      position:absolute;
      inset:6px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ffb0cc, #ff4d8d);
      opacity: .28;
      box-shadow:
        0 12px 26px #ff2a7440,
        inset 0 0 0 1px #ffffff55;
      filter: blur(.2px);
      z-index:0;
    }
    .seal::after{
      content:"";
      position:absolute;
      inset:18px;
      border-radius:999px;
      background:
        linear-gradient(45deg, transparent 45%, #ffffff55 50%, transparent 55%),
        linear-gradient(-45deg, transparent 45%, #ffffff3d 50%, transparent 55%);
      opacity:.25;
      mix-blend-mode: screen;
      z-index:0;
    }

    /* Heart pulse */
    .heart{
      width:86px; height:86px;
      background: radial-gradient(circle at 30% 30%, var(--pink2), var(--pink));
      transform: rotate(45deg);
      border-radius: 16px;
      position:relative;
      box-shadow: 0 10px 24px #ff2a7440, inset 0 0 0 1px #ffffff66;
      animation: pulse 1.6s ease-in-out infinite;
      z-index:1;
    }
    .envelope:hover .heart{ animation-duration: 1.1s; }
    @keyframes pulse{
      0%,100%{ transform: rotate(45deg) scale(1); }
      50%{ transform: rotate(45deg) scale(1.07); }
    }
    .envelope:active{ transform: scale(0.99); }

    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:86px;height:86px;
      background:inherit;
      border-radius:50%;
      top:-42px; left:0;
    }
    .heart:after{ left:-42px; top:0; }

    .seal-text{
      position:absolute;
      font-weight:800;
      letter-spacing:.2px;
      color:#fff;
      text-shadow: 0 2px 10px #00000055;
      transform: translateY(2px);
      font-size:16px;
      padding:10px 12px;
      border-radius:999px;
      background:#00000014;
      backdrop-filter: blur(6px);
      transition: opacity 300ms ease, transform 300ms ease;
      z-index:2;
    }

    /* âœ… Le texte "æ‰“å¼€æˆ‘" disparaÃ®t Ã  l'ouverture */
    .envelope.open .seal-text{
      opacity:0;
      transform: scale(0.92);
      pointer-events:none;
    }

    /* âœ… Coeur pop puis disparaÃ®t Ã  l'ouverture */
    .envelope.open .heart{
      animation: heart-pop 600ms ease forwards;
    }
    @keyframes heart-pop{
      0%{ transform: rotate(45deg) scale(1); opacity:1; }
      60%{ transform: rotate(45deg) scale(1.2); opacity:1; }
      100%{ transform: rotate(45deg) scale(0.6); opacity:0; }
    }

    /* Card content */
    .card{
      width:min(420px, 88vw);
      margin-top:14px;
      padding:16px 16px 12px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:#ffffff0f;
      display:none;
      animation: pop 450ms ease-out;
    }
    @keyframes pop{ from{transform:scale(.96);opacity:0} to{transform:scale(1);opacity:1} }

    .question{ font-size:18px; margin:0 0 10px; line-height:1.3; }
    .sub{ margin:0 0 14px; color:var(--muted); font-size:13px; }

    .btns{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:center;
      position:relative;
      padding-bottom:6px;
    }

    button{
      border:1px solid #ffffff30;
      background:#ffffff14;
      color:var(--txt);
      padding:10px 14px;
      border-radius:999px;
      font-weight:700;
      cursor:pointer;
      transition: transform 120ms ease, background 150ms ease;
      min-width:120px;
    }
    button:hover{ transform: translateY(-1px); background:#ffffff1f; }

    .yes{
      border-color:#ff77a755;
      background: linear-gradient(180deg, #ff4d8d55, #ff4d8d22);
    }
    .yes:hover{ background: linear-gradient(180deg, #ff4d8d66, #ff4d8d2a); }

    .no{ position:relative; }

    .dissolve{
      animation: dissolve 380ms ease forwards;
      pointer-events:none;
    }
    @keyframes dissolve{
      0%{opacity:1; filter: blur(0); transform:scale(1)}
      100%{opacity:0; filter: blur(10px); transform:scale(.92)}
    }

    .final{
      display:none;
      margin-top:10px;
      padding:14px 14px 12px;
      border-radius:16px;
      border:1px solid #ffffff2a;
      background: linear-gradient(180deg, #ffffff14, #ffffff0a);
      line-height:1.45;
      animation: pop 450ms ease-out;
    }
    .final b{ color:var(--gold); }

    /* âœ… TYPEWRITER */
    .typewrap{ white-space: pre-line; }
    .cursor{
      display:inline-block;
      margin-left:2px;
      opacity:1;
      animation: blink 1s step-end infinite;
      color: var(--gold);
      font-weight:800;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    .footer{
      text-align:center;
      margin-top:10px;
      font-size:12px;
      color:#ffffff66;
    }

    .hint{
      text-align:center;
      color:#ffffff88;
      font-size:12px;
      margin-top:10px;
    }

    /* âœ… MOBILE */
    @media (max-width: 480px){
      body{
        display:block;
        overflow-y:auto;
        -webkit-text-size-adjust: 100%;
      }
      .wrap{ width:100%; padding:16px; }
      .panel{ width:100%; padding:16px; border-radius:20px; }
      .stage{ padding:14px 6px 18px; }
      .envelope{ width:100%; max-width:430px; margin:0 auto; }
      .card{ width:100%; max-width:430px; margin:14px auto 0; }
      button{ min-width:44%; padding:12px 14px; font-size:15px; }
      .footer{ font-size:13px; }
    }
  </style>
</head>

<body>
  <div class="float" id="float"></div>

  <div class="wrap">
    <div class="panel">
      <p class="title">ğŸ’Œ ä½ æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯</p>

      <div class="stage">
        <div class="envelope" id="envelope" aria-label="envelope">
          <div class="env-body"></div>
          <div class="flap"></div>
          <div class="seal">
            <div class="heart"></div>
            <div class="seal-text" id="sealText">æ‰“å¼€æˆ‘</div>
          </div>
        </div>

        <div class="hint" id="hint">ç‚¹å‡»ä¿¡å° âœ¨</div>

        <div class="card" id="card">
          <p class="question" id="question">å°å‡¡å®ï¼Œä½ æ„¿æ„å’Œæˆ‘ä¸€èµ·è¿‡æƒ…äººèŠ‚å—ï¼Ÿ ğŸ’</p>
          <p class="sub" id="sub"> </p>

          <div class="btns">
            <button class="yes" id="yesBtn">æ˜¯</button>
            <button class="no" id="noBtn">ä¸</button>
          </div>

          <div class="final" id="final">
            <div class="typewrap" id="typeTarget"></div><span class="cursor" id="cursor">â™¡</span>
          </div>
        </div>

        <div class="footer" id="footer"></div>
      </div>
    </div>
  </div>

  <!-- âœ… Son mp3 (peut Ãªtre bloquÃ© en local file:// ; mieux sur GitHub Pages https://) -->
  <audio id="chime" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-soft-bell-chime-210.mp3" type="audio/mpeg">
  </audio>

  <script>
    // ====== Personnalisation rapide ======
    const CONFIG = {
      sealText: "æ‰“å¼€æˆ‘",
      question: "å°å‡¡å®ï¼Œæƒ…äººèŠ‚ä½ æ„¿æ„å’Œæˆ‘ä¸€èµ·è¿‡å—ï¼Ÿ ğŸ’",
      sub: " ",
      // âœ… On garde le HTML pour l'OR (b, br) mais on va l'Ã©crire en typewriter
      finalHtml: `<b>å°å‡¡å®</b>ï¼Œæˆ‘å¯¹ä½ æœ‰çœŸæŒšçš„æ„Ÿæƒ…ï¼Œä¹Ÿæ„¿æ„ç­‰ä½ ã€‚<br/>æ‰€ä»¥æƒ…äººèŠ‚ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„äººæ˜¯ä½ ã€‚â™¡`,
      footer: "ä½ çš„å°æŸ’æŸ’ â˜ï¸"
    };

    function vib(pattern){
      if (navigator.vibrate) navigator.vibrate(pattern);
    }

    const envelope = document.getElementById("envelope");
    const card = document.getElementById("card");
    const hint = document.getElementById("hint");
    const sealText = document.getElementById("sealText");
    const question = document.getElementById("question");
    const sub = document.getElementById("sub");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const finalBox = document.getElementById("final");
    const footer = document.getElementById("footer");
    const float = document.getElementById("float");
    const chime = document.getElementById("chime");

    // Typewriter nodes
    const typeTarget = document.getElementById("typeTarget");
    const cursor = document.getElementById("cursor");

    // Apply config
    sealText.textContent = CONFIG.sealText;
    question.textContent = CONFIG.question;
    sub.textContent = CONFIG.sub;
    footer.textContent = CONFIG.footer;

    // --- Sound fallback ---
    function webDing(){
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.setValueAtTime(880, ctx.currentTime);
        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.22);
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.24);
        setTimeout(() => ctx.close && ctx.close(), 400);
      }catch(e){}
    }

    function playChime(volume = 0.55){
      if (chime) {
        try{
          chime.currentTime = 0;
          chime.volume = volume;
          const p = chime.play();
          if (p && typeof p.catch === "function") p.catch(() => webDing());
          return;
        }catch(e){ webDing(); return; }
      }
      webDing();
    }

    // âœ… Convertit ton HTML (b, br) en "tokens" pour Ã©crire proprement
    function htmlToTokens(html){
      // On remplace <br/> par \n, <b>...</b> par des marqueurs
      const tmp = html
        .replaceAll("<br/>", "\n")
        .replaceAll("<br>", "\n")
        .replaceAll("<b>", "Â§BÂ§")
        .replaceAll("</b>", "Â§/BÂ§");

      const tokens = [];
      let i = 0;
      let bold = false;

      while(i < tmp.length){
        // marqueur bold on/off
        if (tmp.startsWith("Â§BÂ§", i)){ bold = true; i += 3; continue; }
        if (tmp.startsWith("Â§/BÂ§", i)){ bold = false; i += 4; continue; }

        const ch = tmp[i];
        tokens.push({ ch, bold });
        i++;
      }
      return tokens;
    }

    let typing = false;

    function typeWriterFromHtml(html, el, speed=85){
      if (typing) return;
      typing = true;

      el.innerHTML = "";
      cursor.style.display = "inline-block";

      const tokens = htmlToTokens(html);
      let idx = 0;

      const interval = setInterval(() => {
        const t = tokens[idx++];
        if (!t){ // fini
          clearInterval(interval);
          cursor.style.display = "none";
          typing = false;
          return;
        }

        if (t.ch === "\n"){
          el.appendChild(document.createElement("br"));
          return;
        }

        if (t.bold){
          // Ajouter dans un <b> courant (ou en crÃ©er un)
          const last = el.lastChild;
          if (last && last.nodeType === 1 && last.tagName === "B"){
            last.textContent += t.ch;
          } else {
            const b = document.createElement("b");
            b.textContent = t.ch;
            el.appendChild(b);
          }
        } else {
          // Ajouter en texte normal
          el.append(t.ch);
        }
      }, speed);
    }

    let opened = false;
    envelope.addEventListener("click", () => {
      if (opened) return;
      opened = true;

      vib([20, 30, 20]);
      playChime(0.5);

      envelope.classList.add("open");
      hint.style.display = "none";

      setTimeout(() => {
        card.style.display = "block";
        burstHearts(10);
      }, 450);
    });

    yesBtn.addEventListener("click", () => {
      vib([30, 40, 30]);
      playChime(0.65);

      finalBox.style.display = "block";
      burstHearts(18);

      // âœ… Lancement typewriter
      typeWriterFromHtml(CONFIG.finalHtml, typeTarget, 28);

      yesBtn.disabled = true;
      noBtn.disabled = true;
      yesBtn.style.opacity = 0.6;
      noBtn.style.opacity = 0.6;
    });

    // Bouton non qui esquive + se dissout si "attrapÃ©"
    let dodges = 0;
    const MAX_DODGES = 6;

    function moveNoButton() {
      if (noBtn.classList.contains("dissolve")) return;

      if (dodges >= MAX_DODGES) {
        noBtn.textContent = "â€¦";
        return;
      }

      const area = noBtn.parentElement.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();

      const pad = 8;
      const maxX = area.width - btn.width - pad;
      const maxY = area.height - btn.height - pad;

      const x = Math.max(pad, Math.random() * maxX);
      const y = Math.max(pad, Math.random() * maxY);

      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";

      dodges++;
    }

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); moveNoButton(); }, {passive:false});

    noBtn.addEventListener("click", () => {
      if (dodges < MAX_DODGES) {
        moveNoButton();
        return;
      }
      vib(25);
      noBtn.classList.add("dissolve");
      burstHearts(8);
      setTimeout(() => { noBtn.style.display = "none"; }, 420);
    });

    function burstHearts(n){
      const hearts = ["ğŸ’—","ğŸ’“","ğŸ’","ğŸ’˜","ğŸ’–","ğŸ’•"];
      for(let i=0;i<n;i++){
        const el = document.createElement("div");
        el.className = "h";
        el.textContent = hearts[Math.floor(Math.random()*hearts.length)];
        el.style.left = (Math.random()*100) + "vw";
        el.style.setProperty("--dx", ((Math.random()*220)-110) + "px");
        el.style.animationDelay = (Math.random()*180) + "ms";
        float.appendChild(el);
        setTimeout(()=> el.remove(), 2600);
      }
    }
  </script>
</body>
</html>